import{_ as I}from"./mermaid-graph.vue_vue_type_style_index_0_lang-BKvM6I0T.js";import{b2 as Y,L as M,aq as R,b3 as q,as as J,O as F,b4 as K,b5 as Q,a9 as Z,b6 as ee,B as W,aa as y,ay as T,S as te,au as ne,e as l,g as _,T as L,D as O,ak as ae,b7 as oe,b8 as ie,az as se,b9 as le,ba as re,bb as ue,E as ce,bc as de,aP as G,W as me,d as fe,r as he,o as ve,c as k,w as m,l as s,$,a0 as w,bd as ge,b as U,n as ye,f as C,V as pe,z as xe,be,C as _e,v as Ve}from"./main-B70GkIj-.js";import{C as we}from"./chat-thread-Bttr0b8R.js";import{V as Te}from"./VContainer-DYD4C6sI.js";import{V as Ce,a as Ee,b as Be,c as Se}from"./VExpansionPanels-CUdyAz0T.js";import{V as He}from"./VRow-CuQ7f1Ee.js";import{V as P}from"./VSheet-BzbwK1M5.js";import"./index-B9eHhWSs.js";import"./rating-popup-BZQd9w9G.js";import"./VCol-BMSgih9K.js";/* empty css              */import"./VTextField-CfpYqE7h.js";const Ie=t=>{const{touchstartX:e,touchendX:a,touchstartY:o,touchendY:u}=t,r=.5,n=16;t.offsetX=a-e,t.offsetY=u-o,Math.abs(t.offsetY)<r*Math.abs(t.offsetX)&&(t.left&&a<e-n&&t.left(t),t.right&&a>e+n&&t.right(t)),Math.abs(t.offsetX)<r*Math.abs(t.offsetY)&&(t.up&&u<o-n&&t.up(t),t.down&&u>o+n&&t.down(t))};function We(t,e){var o;const a=t.changedTouches[0];e.touchstartX=a.clientX,e.touchstartY=a.clientY,(o=e.start)==null||o.call(e,{originalEvent:t,...e})}function Ge(t,e){var o;const a=t.changedTouches[0];e.touchendX=a.clientX,e.touchendY=a.clientY,(o=e.end)==null||o.call(e,{originalEvent:t,...e}),Ie(e)}function ke(t,e){var o;const a=t.changedTouches[0];e.touchmoveX=a.clientX,e.touchmoveY=a.clientY,(o=e.move)==null||o.call(e,{originalEvent:t,...e})}function $e(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:t.left,right:t.right,up:t.up,down:t.down,start:t.start,move:t.move,end:t.end};return{touchstart:a=>We(a,e),touchend:a=>Ge(a,e),touchmove:a=>ke(a,e)}}function Ue(t,e){var i;const a=e.value,o=a!=null&&a.parent?t.parentElement:t,u=(a==null?void 0:a.options)??{passive:!0},r=(i=e.instance)==null?void 0:i.$.uid;if(!o||!r)return;const n=$e(e.value);o._touchHandlers=o._touchHandlers??Object.create(null),o._touchHandlers[r]=n,Y(n).forEach(d=>{o.addEventListener(d,n[d],u)})}function Pe(t,e){var r,n;const a=(r=e.value)!=null&&r.parent?t.parentElement:t,o=(n=e.instance)==null?void 0:n.$.uid;if(!(a!=null&&a._touchHandlers)||!o)return;const u=a._touchHandlers[o];Y(u).forEach(i=>{a.removeEventListener(i,u[i])}),delete a._touchHandlers[o]}const A={mounted:Ue,unmounted:Pe},Xe=A,N=Symbol.for("vuetify:v-window"),z=Symbol.for("vuetify:v-window-group"),Ye=M({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:t=>typeof t=="boolean"||t==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...R(),...q(),...J()},"VWindow"),Me=F()({name:"VWindow",directives:{Touch:A},props:Ye(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:a}=e;const{themeClasses:o}=K(t),{isRtl:u}=Q(),{t:r}=Z(),n=ee(t,z),i=W(),d=y(()=>u.value?!t.reverse:t.reverse),v=T(!1),x=y(()=>{const c=t.direction==="vertical"?"y":"x",g=(d.value?!v.value:v.value)?"-reverse":"";return`v-window-${c}${g}-transition`}),V=T(0),b=W(void 0),p=y(()=>n.items.value.findIndex(c=>n.selected.value.includes(c.id)));te(p,(c,h)=>{const g=n.items.value.length,H=g-1;g<=2?v.value=c<h:c===H&&h===0?v.value=!0:c===0&&h===H?v.value=!1:v.value=c<h}),ne(N,{transition:x,isReversed:v,transitionCount:V,transitionHeight:b,rootRef:i});const f=y(()=>t.continuous||p.value!==0),E=y(()=>t.continuous||p.value!==n.items.value.length-1);function B(){f.value&&n.prev()}function S(){E.value&&n.next()}const j=y(()=>{const c=[],h={icon:u.value?t.nextIcon:t.prevIcon,class:`v-window__${d.value?"right":"left"}`,onClick:n.prev,"aria-label":r("$vuetify.carousel.prev")};c.push(f.value?a.prev?a.prev({props:h}):l(_,h,null):l("div",null,null));const g={icon:u.value?t.prevIcon:t.nextIcon,class:`v-window__${d.value?"left":"right"}`,onClick:n.next,"aria-label":r("$vuetify.carousel.next")};return c.push(E.value?a.next?a.next({props:g}):l(_,g,null):l("div",null,null)),c}),D=y(()=>t.touch===!1?t.touch:{...{left:()=>{d.value?B():S()},right:()=>{d.value?S():B()},start:h=>{let{originalEvent:g}=h;g.stopPropagation()}},...t.touch===!0?{}:t.touch});return L(()=>O(l(t.tag,{ref:i,class:["v-window",{"v-window--show-arrows-on-hover":t.showArrows==="hover"},o.value,t.class],style:t.style},{default:()=>{var c,h;return[l("div",{class:"v-window__container",style:{height:b.value}},[(c=a.default)==null?void 0:c.call(a,{group:n}),t.showArrows!==!1&&l("div",{class:"v-window__controls"},[j.value])]),(h=a.additional)==null?void 0:h.call(a,{group:n})]}}),[[ae("touch"),D.value]])),{group:n}}}),Re=M({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...R(),...oe(),...ie()},"VWindowItem"),X=F()({name:"VWindowItem",directives:{Touch:Xe},props:Re(),emits:{"group:selected":t=>!0},setup(t,e){let{slots:a}=e;const o=se(N),u=le(t,z),{isBooted:r}=re();if(!o||!u)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const n=T(!1),i=y(()=>r.value&&(o.isReversed.value?t.reverseTransition!==!1:t.transition!==!1));function d(){!n.value||!o||(n.value=!1,o.transitionCount.value>0&&(o.transitionCount.value-=1,o.transitionCount.value===0&&(o.transitionHeight.value=void 0)))}function v(){var f;n.value||!o||(n.value=!0,o.transitionCount.value===0&&(o.transitionHeight.value=G((f=o.rootRef.value)==null?void 0:f.clientHeight)),o.transitionCount.value+=1)}function x(){d()}function V(f){n.value&&me(()=>{!i.value||!n.value||!o||(o.transitionHeight.value=G(f.clientHeight))})}const b=y(()=>{const f=o.isReversed.value?t.reverseTransition:t.transition;return i.value?{name:typeof f!="string"?o.transition.value:f,onBeforeEnter:v,onAfterEnter:d,onEnterCancelled:x,onBeforeLeave:v,onAfterLeave:d,onLeaveCancelled:x,onEnter:V}:!1}),{hasContent:p}=ue(t,u.isSelected);return L(()=>l(de,{transition:b.value,disabled:!r.value},{default:()=>{var f;return[O(l("div",{class:["v-window-item",u.selectedClass.value,t.class],style:t.style},[p.value&&((f=a.default)==null?void 0:f.call(a))]),[[ce,u.isSelected.value]])]}})),{groupItem:u}}}),Fe={class:"test"},Le={"text-body-2":""},Oe=C("span",{class:"text-grey font-italic"},"Updated 3 min ago",-1),nt=fe({__name:"family-view",setup(t){const e=he({familyMap:void 0,familyTree:void 0,treeWidth:500,treeHeight:500,mindmapWidth:500,mindmapHeight:500,activeGraph:"mindmapGraph",personName:void 0,expandFamily:["graph"],familyChat:void 0,needsUpdate:!1,processingUpdate:!1,readOnly:!1});async function a(){s.debug(s.context(),"entering");const r=$();if(s.debug(s.context(),`person is ${r.person}`),!r.person){s.error(s.context(),"no person");return}e.personName=r.person.given_name;{const{data:n,error:i}=await w.GET("/api/person/me/family",{params:{query:{format:"mermaid_mindmap"}}});s.debug(s.context(),n),i||n.mermaid_mindmap==null?(e.familyMap=`mindmap
  id((**${e.personName}**<br>*self*))
  :::self level0
`,i&&s.error(s.context(),i)):(e.familyMap=n.mermaid_mindmap,s.debug(s.context(),e.familyMap))}{const{data:n,error:i}=await w.GET("/api/person/me/family",{params:{query:{format:"mermaid_graph"}}});s.debug(s.context(),n),i||n.mermaid_graph==null?(e.familyTree=`graph
  id((${e.personName}<br>self))
`,i&&s.error(s.context(),i)):(e.familyTree=n.mermaid_graph,s.debug(s.context(),e.familyTree))}}async function o(){var d;s.debug(s.context(),"entering");const r=$();if(s.debug(s.context(),`accountId is ${(d=r.currentAccount)==null?void 0:d.id}`),!r.currentAccount){s.error(s.context(),"no current account"),e.familyChat=void 0;return}const{data:n,error:i}=await w.GET("/api/account/{account_id}/latestchat",{params:{path:{account_id:r.currentAccount.id},query:{kind:"family_tree",closed:!1}}});i?s.error(s.context(),i):(n==null?e.familyChat=await ge("family_tree"):e.familyChat=n._id,s.debug(s.context(),n,e.familyChat))}ve(async()=>{await a(),await o()});function u(){s.debug(s.context(),"needsUpdate -> true"),e.needsUpdate=!0}return(r,n)=>(U(),k(Te,{class:"h-100 v-col-sm-9 v-col-lg-6"},{default:m(()=>[l(Ve,{class:"py-2 h-60"},{default:m(()=>[l(ye,{class:"h-100"},{default:m(()=>[e.familyChat?(U(),k(we,{key:0,chatId:e.familyChat,readOnly:e.readOnly,onSummaryNeedsUpdate:u},{"footer-bottom":m(()=>[C("div",Fe,[l(Ce,{modelValue:e.expandFamily,"onUpdate:modelValue":n[6]||(n[6]=i=>e.expandFamily=i),class:"mt-1"},{default:m(()=>[l(Ee,{value:"graph",class:"pa-0 ma-0 py-0"},{default:m(()=>[l(Be,{static:"",class:"px-3 py-0"},{default:m(()=>[l(pe,{icon:"mdi-family-tree",size:"x-small"}),C("span",Le,"  "+xe(e.personName?e.personName+"'s":"")+" Family Tree    ",1),Oe]),_:1}),l(Se,null,{default:m(()=>[l(He,{class:"justify-center mb-0"},{default:m(()=>[l(be,{color:"primary",density:"compact",variant:"plain",mandatory:"",modelValue:e.activeGraph,"onUpdate:modelValue":n[0]||(n[0]=i=>e.activeGraph=i)},{default:m(()=>[l(_,{size:"small",value:"familyGraph",icon:"mdi-record",class:"px-4"}),l(_,{size:"small",value:"mindmapGraph",icon:"mdi-record",class:"px-4"})]),_:1},8,["modelValue"])]),_:1}),l(Me,{modelValue:e.activeGraph,"onUpdate:modelValue":n[5]||(n[5]=i=>e.activeGraph=i),style:{"max-height":"300px",overflow:"auto"}},{default:m(()=>[l(X,{value:"familyGraph"},{default:m(()=>[l(P,{height:e.treeHeight,width:e.treeWidth},{default:m(()=>[l(I,{content:e.familyTree,width:e.treeWidth,"onUpdate:width":n[1]||(n[1]=i=>e.treeWidth=i),height:e.treeHeight,"onUpdate:height":n[2]||(n[2]=i=>e.treeHeight=i)},null,8,["content","width","height"])]),_:1},8,["height","width"])]),_:1}),l(X,{value:"mindmapGraph"},{default:m(()=>[l(P,{height:e.mindmapHeight,width:e.mindmapWidth},{default:m(()=>[l(I,{content:e.familyMap,width:e.mindmapWidth,"onUpdate:width":n[3]||(n[3]=i=>e.mindmapWidth=i),height:e.mindmapHeight,"onUpdate:height":n[4]||(n[4]=i=>e.mindmapHeight=i)},null,8,["content","width","height"])]),_:1},8,["height","width"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["chatId","readOnly"])):_e("",!0)]),_:1})]),_:1})]),_:1}))}});export{nt as default};
