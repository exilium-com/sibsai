import{R as z}from"./index-B9eHhWSs.js";import{d as M,r as j,aa as y,l as p,b as d,c as v,w as i,v as q,e as r,af as B,n as O,h as k,z as b,s as _,a5 as D,g as I,V as $,aV as H,bH as X,I as J,f as K,o as Z,y as U,H as R,F,C as N,a0 as T,$ as G,ae as Y,bI as ee,bJ as te,bK as S,D as ne,E as ie,S as ae,a4 as re,aU as oe,bL as le,j as ue}from"./main-B70GkIj-.js";import{V as se}from"./VSpacer-CJQu-8NM.js";import{r as h}from"./form-validation-CyjMhnzu.js";import{V as L}from"./VCol-BMSgih9K.js";import{V as P}from"./VTextField-CfpYqE7h.js";import{V as ce}from"./VRow-CuQ7f1Ee.js";import{V as de,_ as me}from"./VForm-C5FypBKk.js";import{_ as ve}from"./primary-button.vue_vue_type_script_setup_true_lang-1Pjcy-CF.js";import{V as pe,a as fe,c as ge}from"./VExpansionPanels-CUdyAz0T.js";const ye=K("br",null,null,-1),ke=M({__name:"my-invite-card",props:{inviter:{},accountUser:{},inviteDate:{},accept:{type:Boolean}},emits:["update:accept"],setup(C){const t=C,e=j({accountPronoun:y(()=>t.accountUser._id==t.inviter._id?"their":t.accountUser.given_name+"'s"),fullName:y(()=>t.inviter.given_name+(t.inviter.family_name?" "+t.inviter.family_name:""))});return p.debug(p.context(),"props=",t),(u,s)=>(d(),v(J,null,{default:i(()=>[u.accept==null?(d(),v(q,{key:0,title:e.fullName,variant:"tonal"},{prepend:i(()=>[r(B,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??""},null,8,["picture","firstName","lastName"])]),default:i(()=>[r(O,null,{default:i(()=>[k(b(u.inviter.given_name)+" wants to share "+b(e.accountPronoun)+" sibs data with you ",1),ye,r(_(z),{class:"text-grey small",time:u.inviteDate,locale:null},null,8,["time"])]),_:1}),r(D,{class:"mx-4 mb-2"},{default:i(()=>[r(I,{variant:"tonal",color:"success",onClick:s[0]||(s[0]=m=>u.$emit("update:accept",!0))},{default:i(()=>[r($,{icon:"mdi-check-bold"}),k(" Accept ")]),_:1}),r(se),r(I,{variant:"tonal",color:"secondary",onClick:s[1]||(s[1]=m=>u.$emit("update:accept",!1))},{default:i(()=>[r($,{icon:"mdi-close-thick"}),k(" Reject ")]),_:1})]),_:1})]),_:1},8,["title"])):(d(),v(q,{key:1,variant:"flat",density:"compact"},{default:i(()=>[r(H,{color:"secondary-surface"},{prepend:i(()=>[r(B,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??"",badgeColor:"transparent","offset-y":"33"},{badge:i(()=>[u.accept?(d(),v($,{key:0,icon:"mdi-check-bold",color:"success"})):(d(),v($,{key:1,icon:"mdi-close-thick",color:"error"}))]),_:1},8,["picture","firstName","lastName"])]),append:i(()=>[r(I,{size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:s[2]||(s[2]=m=>u.$emit("update:accept",void 0))})]),default:i(()=>[r(X,null,{default:i(()=>[k(" You will "+b(u.accept==!0?"accept "+u.inviter.given_name:"reject "+u.inviter.given_name)+"'s invitation. ",1)]),_:1})]),_:1})]),_:1}))]),_:1}))}}),Se=M({__name:"my-invite-list",setup(C,{expose:t}){const e=j({pendingInvites:[],submitting:!1,loading:!1}),u=y(()=>e.pendingInvites?e.pendingInvites.filter(c=>c.accept==!0).length:0),s=y(()=>e.pendingInvites?e.pendingInvites.filter(c=>c.accept==!1).length:0),m=y(()=>e.pendingInvites.length),E=y(()=>{const c=u.value>1?`Accept ${u.value} invitations`:u.value>0?"Accept 1 invitation":"",A=s.value>1?`Reject ${s.value} invitations`:s.value>0?"Reject 1 invitation":"",f=u.value>0&&s.value>0?", ":"";return c+f+A});t({invitationsCount:m});async function o(){e.loading=!0;try{let c=await T.GET("/api/person/me/invites",{});if(p.debug(p.context(),"response = ",c),!c.data||c.error)throw new Error(c.error);e.pendingInvites=c.data;const A=G();A.invitationCount=e.pendingInvites.length??0,p.debug(p.context(),"invitationCount=",A.invitationCount)}catch(c){p.error(p.context(),"getInvites error",c)}finally{e.loading=!1}}Z(async()=>{await o()});async function g(){let c=[],A=[];try{e.submitting=!0,e.pendingInvites.map(w=>{w.accept===!0?c.push(w.account_id):w.accept===!1&&A.push(w.account_id)});const{error:f}=await T.POST("/api/person/me/invites",{body:{accept_invites:c,reject_invites:A}});if(f){p.error(p.context(),f);return}await o()}finally{e.submitting=!1}}return(c,A)=>e.pendingInvites.length>0?(d(),v(q,{key:0,title:"Invitations You Received",loading:e.loading},{default:i(()=>[(d(!0),U(F,null,R(e.pendingInvites,f=>(d(),v(O,{key:f.account_id},{default:i(()=>[r(ke,{accept:f.accept,"onUpdate:accept":w=>f.accept=w,inviter:f.inviter,"account-user":f.account_user,"invite-date":new Date(f.invite_date)},null,8,["accept","onUpdate:accept","inviter","account-user","invite-date"])]),_:2},1024))),128)),E.value?(d(),v(D,{key:0},{default:i(()=>[r(I,{block:"",color:"secondary",variant:"elevated",onClick:g,loading:e.submitting},{default:i(()=>[k(b(E.value),1)]),_:1},8,["loading"])]),_:1})):N("",!0)]),_:1},8,["loading"])):N("",!0)}}),_e={key:0},Ae={key:1,class:"text-grey small"},x=M({__name:"account-manager-item",props:{manager:{},pending:{type:Boolean},date:{},revoke:{type:Boolean},currentAccount:{}},emits:["update:revoke"],setup(C){const t=C;function e(o){return S(t.currentAccount.value)?o?"your":"you":t.currentAccount.value.user.given_name+(o?"'s":"")}function u(o){var c;return((c=G().person)==null?void 0:c._id)==o._id||t.currentAccount.value.user._id==o._id}function s(o){return o.given_name+(o.family_name?" "+o.family_name:"")}function m(o,g){return g?o?"Your":"You":o?"your":"you"}function E(o,g,c){var f;return((f=G().person)==null?void 0:f._id)==o._id?m(g,c):s(o)+(g?"'s":"")}return(o,g)=>(d(),v(H,null,Y({prepend:i(()=>[r(B,{picture:o.manager.avatar??void 0,firstName:o.manager.given_name,lastName:o.manager.family_name??"",badgeColor:"transparent","offset-y":"30"},Y({_:2},[t.revoke?{name:"badge",fn:i(()=>[r($,{icon:"mdi-close-thick",color:"error"})]),key:"0"}:void 0]),1032,["picture","firstName","lastName"])]),default:i(()=>[o.revoke?N("",!0):(d(),v(ee,{key:0},{default:i(()=>[k(b(E(o.manager,!1,!0)),1)]),_:1})),u(o.manager)?N("",!0):(d(),v(te,{key:1},{default:i(()=>[o.revoke?(d(),U("span",_e," You will "+b(o.pending?"not share":"stop sharing")+" "+b(e(!0))+" sibs data with "+b(E(o.manager,!1,!1)),1)):o.date?(d(),U("span",Ae,[k(" Invited "),r(_(z),{time:new Date(o.date),locale:null},null,8,["time"])])):N("",!0)]),_:1}))]),_:2},[u(o.manager)?void 0:{name:"append",fn:i(()=>[o.revoke?(d(),v(I,{key:0,size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:g[0]||(g[0]=c=>o.$emit("update:revoke",!1))})):(d(),v(I,{key:1,onClick:g[1]||(g[1]=c=>o.$emit("update:revoke",!0)),color:"success",variant:"tonal",class:"px-2"},{default:i(()=>[r($,{icon:"mdi-close-thick"}),k(" Revoke ")]),_:1}))]),key:"0"}]),1024))}}),be=M({__name:"invitation-form",props:{givenName:{},familyName:{},email:{},emailConfirmation:{},phone:{}},emits:["update:givenName","update:familyName","update:email","update:emailConfirmation","update:phone","update:formOk"],setup(C){const t=C,e=j({formOk:!1});return(u,s)=>(d(),v(de,{class:"pa-1",value:e.formOk,"onUpdate:modelValue":s[5]||(s[5]=m=>u.$emit("update:formOk",m))},{default:i(()=>[r(ce,null,{default:i(()=>[r(L,null,{default:i(()=>[r(P,{type:"text",label:"Their first name",id:"givenName",value:t.givenName,"onUpdate:modelValue":s[0]||(s[0]=m=>u.$emit("update:givenName",m)),rules:[_(h).required,_(h).name],required:"",class:"required"},null,8,["value","rules"])]),_:1}),r(L,null,{default:i(()=>[r(P,{type:"text",label:"Their last name",id:"familyName",value:t.familyName,"onUpdate:modelValue":s[1]||(s[1]=m=>u.$emit("update:familyName",m)),rules:[_(h).required,_(h).name],required:"",class:"required"},null,8,["value","rules"])]),_:1})]),_:1}),r(P,{type:"email",label:"Their e-mail",id:"email",value:t.email,"onUpdate:modelValue":s[2]||(s[2]=m=>u.$emit("update:email",m)),rules:[_(h).required,_(h).email],required:"",class:"required"},null,8,["value","rules"]),r(J,null,{default:i(()=>[ne(r(P,{type:"email",label:"Confirm  e-mail",id:"emailConfirmation",value:t.emailConfirmation,"onUpdate:modelValue":s[3]||(s[3]=m=>u.$emit("update:emailConfirmation",m)),rules:[_(h).required,_(h).email,_(h).sameAs(u.email,"e-mails")],required:"",class:"required"},null,8,["value","rules"]),[[ie,u.email]])]),_:1}),r(P,{type:"tel",label:"Their phone",id:"phone",value:t.phone,"onUpdate:modelValue":s[4]||(s[4]=m=>u.$emit("update:phone",m)),rules:[_(h).phoneOrBlank]},null,8,["value","rules"])]),_:1},8,["value"]))}}),he=M({__name:"account-manager-list",props:{currentAccount:{}},setup(C){const t=C,e=j({expand:!1,submitting:!1,inviting:!1,loading:!1,currentAccountAdmins:[],currentAccountInvites:[],inviteeGivenName:"",inviteeFamilyName:"",inviteeEmail:"",inviteeEmailConfirmation:"",inviteePhone:"",inviteeFormOk:!1,invitePanel:[],inviteError:!1,inviteErrorMsg:"",inviteErrorTitleMsg:""}),u=y(()=>e.currentAccountInvites?e.currentAccountInvites.filter(l=>l.revoke&&l.pending).length:0),s=y(()=>e.currentAccountAdmins?e.currentAccountAdmins.filter(l=>l.revoke&&!l.pending).length:0),m=y(()=>{if(e.currentAccountAdmins==null)return;let l=!1;for(let n of e.currentAccountAdmins)if(n.person._id!=t.currentAccount.value.user._id){l=!0;break}return l}),E=y(()=>m.value?S(t.currentAccount.value)?"You are sharing your sibs data with:":`${c.value} is sharing their sibs data with:`:S(t.currentAccount.value)?"Share your sibs data":`${c.value} is not sharing their sibs data with anyone`),o=y(()=>!m.value&&S(t.currentAccount.value)?"You can invite other people to share your data. They will be able to see your data and help you whenever needed.":""),g=y(()=>{const l=u.value+s.value;return l>1?`Stop sharing with ${l} people`:l>0?`Stop sharing with ${l} person`:""}),c=y(()=>t.currentAccount.value.user.given_name+(t.currentAccount.value.user.family_name?" "+t.currentAccount.value.user.family_name:""));function A(l){return S(t.currentAccount.value)?l?"your":"you":t.currentAccount.value.user.given_name+(l?"'s":"")}ae(t.currentAccount,async()=>{e.currentAccountAdmins=void 0,e.currentAccountInvites=void 0,e.loading=!0;try{await f(),await w()}finally{e.loading=!1}},{immediate:!0});async function f(){const{data:l,error:n}=await T.GET("/api/account/{account_id}/admins",{params:{path:{account_id:t.currentAccount.value.id}}});n&&p.error(p.context(),n),e.currentAccountAdmins=l?l.map(a=>({person:a})):[]}async function w(){const{data:l,error:n}=await T.GET("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}}});n&&p.error(p.context(),n);let a=l?l.filter(V=>V.state==="pending"):[];e.currentAccountInvites=a.map(V=>({person:V.invitee,invite_date:V.invite_date,pending:!0}))}async function Q(){let l=[];for(let n of e.currentAccountAdmins??[])n.revoke&&l.push(n.person._id);for(let n of e.currentAccountInvites??[])n.revoke&&l.push(n.person._id);try{if(e.submitting=!0,l.length>0){const{error:n}=await T.PATCH("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}},body:l});n&&p.error(p.context(),n),await f(),await w()}}finally{e.submitting=!1}}async function W(){var l;try{e.inviting=!0;const n=await T.POST("/api/account/{account_id}/invite",{params:{path:{account_id:t.currentAccount.value.id}},body:{given_name:e.inviteeGivenName,family_name:e.inviteeFamilyName||void 0,email:e.inviteeEmail,phone:e.inviteePhone||void 0}});if(n.error){const a={403:"You can't invite other parties to this account",405:"Maximum number of invites reached for this account",409:"This person is already invited to this account"};e.inviteError=!0,e.inviteErrorMsg=a[n.response.status]??"Error inviting this person",e.inviteErrorTitleMsg="Problem inviting "+e.inviteeGivenName,p.error(p.context(),"inviteError",e.inviteErrorMsg,e.inviteErrorTitleMsg)}else{let a={person:n.data.invitee,invite_date:n.data.invite_date,pending:!0};(l=e.currentAccountInvites)==null||l.push(a),e.inviteeGivenName="",e.inviteeFamilyName="",e.inviteeEmail="",e.inviteeEmailConfirmation="",e.inviteePhone="",e.invitePanel=[],e.inviteError=!1,e.inviteErrorMsg="",e.inviteErrorTitleMsg=""}}finally{e.inviting=!1}}return(l,n)=>t.currentAccount.value.user._id?(d(),v(q,{key:0,color:"surface",loading:e.loading},{default:i(()=>[r(re,{class:"text-wrap"},{default:i(()=>[k(b(E.value),1)]),_:1}),r(O,null,{default:i(()=>[k(b(o.value)+" ",1),r(oe,null,{default:i(()=>[(d(!0),U(F,null,R(e.currentAccountAdmins,a=>(d(),U(F,null,[a.person._id!=t.currentAccount.value.user._id?(d(),v(x,{key:a.person._id??a.person.email,revoke:a.revoke,"onUpdate:revoke":V=>a.revoke=V,manager:a.person,"current-account":t.currentAccount,lines:"two"},null,8,["revoke","onUpdate:revoke","manager","current-account"])):N("",!0)],64))),256)),e.currentAccountInvites&&e.currentAccountInvites.length>0?(d(),v(le,{key:0},{default:i(()=>[k(" Pending")]),_:1})):N("",!0),(d(!0),U(F,null,R(e.currentAccountInvites,a=>(d(),v(x,{key:a.person._id??a.person.email,variant:"tonal",lines:"two",revoke:a.revoke,"onUpdate:revoke":V=>a.revoke=V,manager:a.person,"current-account":t.currentAccount,pending:!0,date:new Date(a.invite_date)},null,8,["revoke","onUpdate:revoke","manager","current-account","date"]))),128))]),_:1})]),_:1}),g.value?(d(),v(D,{key:0},{default:i(()=>[r(I,{block:"",color:"secondary",variant:"elevated",onClick:Q,loading:e.submitting},{default:i(()=>[k(b(g.value),1)]),_:1},8,["loading"])]),_:1})):N("",!0),r(O,null,{default:i(()=>[r(pe,{multiple:"",modelValue:e.invitePanel,"onUpdate:modelValue":n[9]||(n[9]=a=>e.invitePanel=a)},{default:i(()=>[r(fe,{"bg-color":"info-surface",color:"info-surface",value:"invite",title:`Share ${A(!0)} sibs data with another person`},{default:i(()=>[r(ge,{id:"expansionPanelText",color:"info-surface"},{default:i(()=>[r(be,{"given-name":e.inviteeGivenName,"onUpdate:givenName":n[0]||(n[0]=a=>e.inviteeGivenName=a),"family-name":e.inviteeFamilyName,"onUpdate:familyName":n[1]||(n[1]=a=>e.inviteeFamilyName=a),email:e.inviteeEmail,"onUpdate:email":n[2]||(n[2]=a=>e.inviteeEmail=a),"email-confirmation":e.inviteeEmailConfirmation,"onUpdate:emailConfirmation":n[3]||(n[3]=a=>e.inviteeEmailConfirmation=a),phone:e.inviteePhone,"onUpdate:phone":n[4]||(n[4]=a=>e.inviteePhone=a),"onUpdate:formOk":n[5]||(n[5]=a=>e.inviteeFormOk=a)},null,8,["given-name","family-name","email","email-confirmation","phone"]),K("div",null,[r(me,{error:"",msg:e.inviteErrorMsg,"onUpdate:msg":n[6]||(n[6]=a=>e.inviteErrorMsg=a),title:e.inviteErrorTitleMsg,"onUpdate:title":n[7]||(n[7]=a=>e.inviteErrorTitleMsg=a),class:"mb-4"},null,8,["msg","title"]),r(ve,{color:"info",block:"",onClick:n[8]||(n[8]=a=>W()),disabled:!e.inviteeFormOk,loading:e.inviting,enabledColor:"info"},{default:i(()=>[k("Invite")]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading"])):N("",!0)}}),Me=ue(he,[["__scopeId","data-v-f6110db4"]]);export{Me as A,Se as _};
