import{d as O,r as U,B as $,c as p,w as a,a as D,k as w,b as l,v as y,f as d,e as r,V as x,m as _,y as n,z as V,t as v,h as u,C as I,n as k,s as E,x as R}from"./main-B70GkIj-.js";import{r as b}from"./form-validation-CyjMhnzu.js";import{V as P,_ as S,a as T}from"./VForm-C5FypBKk.js";import{_ as B}from"./password-field.vue_vue_type_script_setup_true_lang-CFmEeVXv.js";import{V as F}from"./VContainer-DYD4C6sI.js";import{V as A}from"./VTextField-CfpYqE7h.js";import"./VSheet-BzbwK1M5.js";/* empty css              */const L={class:"text-center"},K={key:0,class:"text-center text-h5 font-weight-black mt-2"},W={key:1,class:"text-center text-h5 font-weight-black mt-2"},z={key:0,class:"my-6"},G={key:1,class:"my-6"},q={key:0,class:"text-grey mt-4 text-center"},j={class:"text-center"},H=d("p",{class:"text-center text-h5 font-weight-black mt-2"},"Forgot your password?",-1),J=d("p",{class:"my-6"},"Enter your email address and we will send you instructions to reset your password",-1),M={class:"text-center mt-4"},ae=O({__name:"reset-view",props:{token:{},email:{},inviter:{}},setup(C){const N=D(),i=C,e=U({email:"",resetting:!1,password:"",formValid:!1,message:{text:"",title:""}}),f=$();async function g(m){e.resetting=!0;try{let t=await R.sendPasswordResetEmail({formFields:[{id:"email",value:m}]});t.status==="FIELD_ERROR"?t.formFields.forEach(o=>{o.id==="email"&&(e.message={error:!0,title:"Invalid email",text:o.error})}):t.status==="PASSWORD_RESET_NOT_ALLOWED"?e.message={error:!0,title:"Password cannot be reset",text:"This account does not allow password reset"}:(e.message={title:"Password Reset",text:`Email will be sent to ${e.email} if account exists`},f.value.reset())}catch(t){t.isSuperTokensGeneralError===!0?e.message={error:!0,title:"Error",text:t.message}:e.message={error:!0,title:"Error"}}finally{e.resetting=!1}}async function c(m){try{e.resetting=!0;let t=await R.submitNewPassword({formFields:[{id:"password",value:m}]});t.status==="FIELD_ERROR"?t.formFields.forEach(o=>{o.id==="password"?e.message={error:!0,title:"Invalid password",text:o.error}:e.message={error:!0,title:"Password reset failed",text:o.error}}):t.status==="RESET_PASSWORD_INVALID_TOKEN_ERROR"?e.message={error:!0,title:"Password reset failed",text:"Please try again"}:N.push({name:"signin"})}catch(t){t.isSuperTokensGeneralError===!0?e.message={error:!0,title:"Password reset failed",text:t.message}:e.message={error:!0,title:"Password reset failed",text:"Please try again"}}finally{e.resetting=!1}}return(m,t)=>{const o=w("v-gap"),h=w("router-link");return l(),p(F,null,{default:a(()=>[i.token?(l(),p(y,{key:0,elevated:"",elevation:"4",class:"mx-auto","max-width":"344"},{title:a(()=>[d("div",L,[r(_,null,{default:a(()=>[r(x,{icon:"custom:logo",size:"x-large",color:"primary"})]),_:1})]),i.inviter?(l(),n("p",K,"Welcome to sibs.ai")):(l(),n("p",W,"Reset your password"))]),default:a(()=>[r(k,null,{default:a(()=>[r(P,{modelValue:e.formValid,"onUpdate:modelValue":t[5]||(t[5]=s=>e.formValid=s),ref_key:"form",ref:f},{default:a(()=>[i.inviter?(l(),n("p",z,V(i.inviter)+" invited you to share their data with you. Set a new password to create your account ",1)):(l(),n("p",G,"Enter a new password")),r(B,{autofocus:"",password:e.password,"onUpdate:password":t[0]||(t[0]=s=>e.password=s)},null,8,["password"]),r(o,{y:"4"}),r(S,{error:e.message.error??!1,msg:e.message.text,"onUpdate:msg":t[1]||(t[1]=s=>e.message.text=s),title:e.message.title,"onUpdate:title":t[2]||(t[2]=s=>e.message.title=s),class:"mb-4"},null,8,["error","msg","title"]),r(T,{loading:e.resetting,disabled:!e.formValid||e.resetting,color:"primary",block:"",onKeydown:t[3]||(t[3]=v(s=>c(e.password),["enter"])),onClick:t[4]||(t[4]=s=>c(e.password))},{default:a(()=>[u(" Set new password ")]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),i.email?(l(),n("p",q,"This invite is for "+V(i.email),1)):I("",!0)]),_:1})]),_:1})):(l(),p(y,{key:1,elevated:"",elevation:"4",class:"mx-auto","max-width":"344"},{title:a(()=>[d("div",j,[r(_,null,{default:a(()=>[r(x,{icon:"custom:logo",size:"x-large",color:"primary"})]),_:1})]),H]),default:a(()=>[r(k,null,{default:a(()=>[r(P,{modelValue:e.formValid,"onUpdate:modelValue":t[11]||(t[11]=s=>e.formValid=s),ref_key:"form",ref:f},{default:a(()=>[J,r(A,{"append-inner-icon":"mdi-email-outline",modelValue:e.email,"onUpdate:modelValue":t[6]||(t[6]=s=>e.email=s),color:"primary",label:"Email",type:"email",density:"comfortable",autofocus:"",rules:[E(b).required,E(b).email]},null,8,["modelValue","rules"]),r(S,{error:e.message.error??!1,msg:e.message.text,"onUpdate:msg":t[7]||(t[7]=s=>e.message.text=s),title:e.message.title,"onUpdate:title":t[8]||(t[8]=s=>e.message.title=s),class:"mb-4"},null,8,["error","msg","title"]),r(T,{loading:e.resetting,disabled:!e.formValid||e.resetting,color:"primary",block:"",onKeydown:t[9]||(t[9]=v(s=>g(e.email),["enter"])),onClick:t[10]||(t[10]=s=>g(e.email))},{default:a(()=>[u(" Reset ")]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),d("p",M,[u("Back to "),r(h,{to:{name:"signin"}},{default:a(()=>[u("sign in")]),_:1})])]),_:1})]),_:1}))]),_:1})}}});export{ae as default};
